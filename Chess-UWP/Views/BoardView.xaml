<Page
    x:Class="Chess_UWP.Views.BoardView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:Chess_UWP.Models"
    xmlns:converters="using:Chess_UWP.Infrastructure.Converters"
    xmlns:controls="using:Chess_UWP.Controls"
    xmlns:cl="using:Caliburn.Micro"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Height="900" Width="1200">

    <Page.Resources>
        <converters:ColorToSolidColorBrushConverter x:Key="ColorToSolidColorBrushConverter"/>
        <converters:PositionToMarginConverter x:Key="PositionToMarginConverter"/>

        <Style TargetType="Border">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid Width="800" Height="800"
              BorderThickness="2" BorderBrush="Black"
              CornerRadius="4">
            <ItemsControl x:Name="Cells">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="local:BoardCell">
                        <Rectangle Width="{x:Bind CellSize}" Height="{x:Bind CellSize}"
                                   Fill="{x:Bind Color, Converter={StaticResource ColorToSolidColorBrushConverter}}"
                                   Margin="{x:Bind Position, Converter={StaticResource PositionToMarginConverter}}"
                                   cl:Message.Attach="[Event Tapped] = [Action CellClick($dataContext)]">
                        </Rectangle>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <ItemsControl x:Name="Figures">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <controls:FigureView cl:Bind.Model="{Binding}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>

        <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                Width="180"
                Height="40"
                Margin="10,50"
                Padding="4">
            <TextBlock x:Name="Timer"
                       Text="Seconds left: 000"/>
        </Border>
        <Border HorizontalAlignment="Left"
                Width="180"
                Margin="10,100,0,50"
                Padding="4">

            <ItemsControl x:Name="Moves">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="local:Move">
                        <TextBlock Text="{x:Bind Result}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>

        <Grid x:Name="PawnPromotionGrid"
              Visibility="{Binding IsPawnPromotion}">
            <Grid.Background>
                <SolidColorBrush Color="Gray" Opacity="0.5"/>
            </Grid.Background>
            <ItemsControl x:Name="PawnPromotionTypes"
                          VerticalAlignment="Center">
                <ItemsPanelTemplate>
                    <StackPanel/>
                </ItemsPanelTemplate>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button HorizontalAlignment="Center"
                                Margin="0,0,0,8"
                                Width="120"
                                Content="{Binding}"
                                Background="Wheat"
                                cl:Message.Attach="[Event Tapped] = [Action PawnPromotion($dataContext)]">
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </Grid>
</Page>
